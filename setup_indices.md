# Index Setup & Mapping

This document provides the complete schema required for the Autonomous-Incident-Engine.

1. Incident Logs Index

Targeted by the log_ingestor.py script.

Index: logs-incident-mvp | Data View: Incident logs (Pattern: logs-incident-*)

```json
PUT /logs-incident-mvp
{
  "mappings": {
    "properties": {
      "@timestamp": { "type": "date" },
      "service": { "properties": { "name": { "type": "keyword" } } },
      "log": { "properties": { "level": { "type": "keyword" } } },
      "http": {
        "properties": {
          "request": { "properties": { "path": { "type": "keyword" }, "method": { "type": "keyword" } } },
          "response": { "properties": { "status_code": { "type": "integer" } } }
        }
      },
      "error": {
        "properties": {
          "message": { "type": "text" },
          "type": { "type": "keyword" },
          "stack_trace": { "type": "text" }
        }
      },
      "message": { "type": "text" }
    }
  }
}
```

2. GitHub Pull Requests Index
Used by the Specialist Agent to correlate code changes with incident timestamps.

```json

PUT /github-prs
{
  "mappings": {
    "properties": {
      "service": { 
        "properties": { 
          "name": { "type": "keyword" } 
        } 
      },
      "pr": { 
        "properties": { 
          "id": { "type": "keyword" }, 
          "author": { "type": "keyword" }, 
          "title": { "type": "text" }, 
          "change_summary": { "type": "text" },
          "html_url": { "type": "keyword" } 
        } 
      },
      "merged_at": { "type": "date" }
    }
  }
}
```

3. Service Metadata Index
Maps services to GitHub repositories for the get_team_metadata tool.

```json
PUT /service-metadata
{
  "mappings": {
    "properties": {
      "service": {
        "properties": {
          "name": {
            "type": "keyword"
          }
        }
      },
      "team": {
        "properties": {
          "owner": {
            "type": "keyword"
          },
          "slack_channel": { 
            "type": "keyword" }
        }
      },
      "runbook_url": {
        "type": "keyword"
      },
      "service_type": { "type": "keyword" },
      "infrastructure": { "type": "keyword" }
    }
  }
}
```

4. Investigation History Index
The final destination for RCA reports generated by the workflow.

```json

PUT /sre-ai-investigations
{
  "mappings": {
    "properties": {
      "@timestamp": { "type": "date" },
      "alert_id": { "type": "keyword" },
      "service": { "type": "keyword" },
      "full_analysis": { "type": "text" }
    }
  }
}
```

# ðŸš€ Setup Actions (Run Order)

Follow this exact sequence:

Initialize Indices: Run the PUT commands above.

Seed Metadata: Add your service mapping:

```json
POST /service-metadata/_doc/payment-api-metadata
{
  "service": {
    "name": "payment-api"
  },
  "team": {
    "owner": "FinTech-Squad",
    "slack_channel": "#incident-alerts"
  },
  "runbook_url": "https://internal-wiki.com/runbook/payment-api",
  "service_type": "microservice",
  "infrastructure": "kubernetes"
}

POST /service-metadata/_doc/auth-service-metadata
{
  "service": {
    "name": "auth-service"
  },
  "team": {
    "owner": "Security-Team",
    "slack_channel": "#security-critical"
  },
  "runbook_url": "https://internal-wiki.com/runbook/auth-service",
  "service_type": "security-service",
  "infrastructure": "lambda"
}
```

Seed PR History: Add PR mappings

```json
POST /github-prs/_doc/pr-99
{
  "service": {
    "name": "payment-api"
  },
  "pr": {
    "id": "PR-99",
    "author": "sarah_dev",
    "title": "Fix: Optimized database connection pooling",
    "change_summary": "Decreased the max_connections from 50 to 5 to reduce memory overhead. Impacted modules: database-config, connection-manager.",
    "html_url": "https://github.com/example-org/repo/pull/99"
  },
  "merged_at": "2026-02-09T08:30:00Z"
}
POST /github-prs/_doc/pr-102
{
  "service": {
    "name": "auth-service"
  },
  "pr": {
    "id": "PR-102",
    "author": "security_dev",
    "title": "Security patch for JWT tokens",
    "change_summary": "Rotated secrets and updated token expiry logic.",
    "html_url": "https://github.com/example-org/repo/pull/102"
  },
  "merged_at": "2026-02-09T08:15:00Z"
}
POST /github-prs/_doc/pr-101
{
  "service": {
    "name": "payment-api"
  },
  "pr": {
    "id": "PR-101",
    "author": "bob_frontend",
    "title": "Update README and logging formatting",
    "change_summary": "Improved documentation and changed log color to blue. No logic changes.",
    "html_url": "https://github.com/example-org/repo/pull/101"
  },
  "merged_at": "2026-02-09T09:00:00Z"
}
POST /github-prs/_doc/pr-98
{
  "service": {
    "name": "payment-api"
  },
  "pr": {
    "id": "PR-98",
    "author": "john_db",
    "title": "Database index optimization",
    "change_summary": "Added a new index to the transactions table for better performance.",
    "html_url": "https://github.com/example-org/repo/pull/98"
  },
  "merged_at": "2026-02-07T10:00:00Z"
}
```
Trigger Incident: Run log_ingestor.py. The alert will fire, and the Autonomous-Incident-Engine will correlate the 500 errors with the relevant PRs.
